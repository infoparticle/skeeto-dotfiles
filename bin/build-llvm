#!/bin/sh
set -e

if [ $# -gt 0 -o -t 0 ]; then
    printf 'usage %s <llvm-project-VERSION.tar.xz\n' "$0" >&2
    exit 1
fi

set -x
tar xJ
cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX="$HOME/.local" \
    -DLLVM_USE_LINKER=gold \
    -DLLVM_ENABLE_PROJECTS="clang;compiler-rt;openmp;polly;flang;mlir" \
    llvm-project*/llvm/
make -kj$(nproc)
